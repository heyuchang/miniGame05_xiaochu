{"version":3,"sources":["assets\\Script\\Moudle\\View\\ShortageView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import LayerPanel, {UrlInfo} from \"../../Common/manage/Layer/LayerPanel\";\r\nimport Global from \"../../Common/Global\";\r\nimport LoadMgr from \"../../Common/manage/LoadMgr\";\r\nimport GameLog from \"../../Common/manage/GameLogMgr\";\r\nimport CacheMgr from \"../../Common/manage/CacheMgr\";\r\nimport Tools from \"../../Common/Tools\";\r\nimport url = cc.url;\r\nimport PanelMgr from \"../../Common/manage/PanelMgr\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n@ccclass\r\nexport default class ShortageView extends LayerPanel {\r\n    public static getUrl(): UrlInfo {\r\n        return {\r\n            bundle: \"shortageView\",\r\n            name: \"shortageView\"\r\n        }\r\n    }\r\n\r\n    //node\r\n    private _image: cc.Node = null;\r\n    private _button: cc.Node = null;\r\n    private _skipButton: cc.Node = null;\r\n    private _addNum: cc.Node = null\r\n\r\n    private callBack: Function = null;  // 玩家领取成功对应的道具 回调\r\n    private price: number = 0; //当前逻辑所需要的消耗数量\r\n\r\n    public initUI() {\r\n        this._image = this.getNode(\"image\");\r\n        this._button = this.getNode(\"button\");\r\n        this._skipButton = this.getNode(\"skip\");\r\n        this._addNum = this.getNode(\"add_num\")\r\n    }\r\n\r\n    /**\r\n     * @param param  {\r\n     *     type  :   string   不足类型  例如   gold : 金币  st\r\n     *     callBack : Function  //回调\r\n     *     price :   number   本次展示观看视频成功之后，回调执行条件价格\r\n     * }\r\n     */\r\n    public show(param: any) {\r\n        try {\r\n            let type: string = \"\"\r\n            if (param) {\r\n                this.callBack = param.callBack;\r\n                this.price = param.price;\r\n                type = param.type;\r\n            }\r\n\r\n            this._image.active = false;\r\n            this._skipButton.active = false;\r\n            this._button.active = false;\r\n\r\n            this.replaceSprite(this._image, type);\r\n            this.replaceSprite(this._skipButton, type);\r\n            this.replaceSprite(this._button, type);\r\n\r\n            let addNum = Global.config.addInfo[type]\r\n            this._addNum.getComponent(cc.Label).string = \"+\" + addNum\r\n\r\n            this.onTouch(this._button, () => {\r\n                Tools.handleVideo().then((res) => {\r\n                    if (res) {\r\n                        if (type == \"gold\") {\r\n                            CacheMgr.gold = CacheMgr.gold + addNum\r\n                            PanelMgr.INS.closePanel(ShortageView)\r\n                            if (this.callBack && CacheMgr.gold >= this.price) {\r\n                                CacheMgr.gold = CacheMgr.gold - this.price\r\n                                this.callBack()\r\n                            }\r\n                        } else if (type == \"diamond\") {\r\n                            CacheMgr.diamond = CacheMgr.diamond + addNum\r\n                            PanelMgr.INS.closePanel(ShortageView)\r\n                            if (this.callBack && CacheMgr.diamond >= this.price) {\r\n                                CacheMgr.diamond = CacheMgr.diamond - this.price\r\n                                this.callBack()\r\n                            }\r\n                        } else if (type == \"stamina\") {\r\n                            CacheMgr.stamina = CacheMgr.stamina + addNum\r\n                            PanelMgr.INS.closePanel(ShortageView)\r\n                            if (this.callBack && CacheMgr.stamina >= this.price) {\r\n                                CacheMgr.stamina = CacheMgr.stamina - this.price\r\n                                this.callBack()\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            this.onTouch(this._skipButton, () => {\r\n                PanelMgr.INS.closePanel(ShortageView)\r\n            });\r\n\r\n            this.node.active = true;\r\n        } catch (e) {\r\n            GameLog.error('home show error ');\r\n        }\r\n    }\r\n\r\n    //替换图片\r\n    public replaceSprite(node: cc.Node, type: string) {\r\n        if (!node || !type) {\r\n            return;\r\n        }\r\n        let sprite = node.getComponent(cc.Sprite)\r\n        if (!sprite) {\r\n            return;\r\n        }\r\n        LoadMgr.loadSprite(sprite, \"view/shortage/\" + type + \"/\" + node.name).then();\r\n    }\r\n\r\n    public hide() {\r\n    }\r\n}\r\n"]}