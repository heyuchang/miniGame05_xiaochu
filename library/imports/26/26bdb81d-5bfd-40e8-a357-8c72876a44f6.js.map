{"version":3,"sources":["assets\\Script\\Common\\manage\\CacheMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import JiuWuSDK from \"../../SDK/JiuWuSDK\";\r\nimport Global from \"../Global\";\r\nimport Tools from \"../Tools\";\r\n\r\nclass CachesMgr {\r\n\r\n\r\n    constructor() {\r\n        let string = Object.keys(this)\r\n        for (let i = 0; i < string.length; i++) {\r\n            if (string[i][0] != \"_\") {\r\n                continue\r\n            }\r\n            this.getData(string[i])\r\n        }\r\n    }\r\n\r\n    private _userId: number = 0;\r\n    private _checkpoint: number = 0;  //关卡\r\n    private _gold: number = 0; //金币\r\n    private _diamond: number = 0; //钻石\r\n    private _stamina: number = 20;\r\n\r\n    private _user_code: string = \"\";\r\n    private _openId: string = \"\";\r\n\r\n    private _lastTimeLogin: number = 0;\r\n    private _hit: any[] = [] //提示字符串\r\n    private _userInfo: any = null;\r\n    private _newUser: boolean = false;\r\n\r\n    private _nowCheckPoint: number = -1;\r\n\r\n    private _isNeedHint: boolean = true;\r\n    private _isAuth: boolean = false;   // 玩家是否授权\r\n    private _setting: CustomData = {\r\n        signTime: 0,\r\n        hammerNum: 0,\r\n        spriteNum: 0,\r\n        lastSignNum: 0,\r\n        signNum: -1,\r\n        hintNum: 5,\r\n        setting: {\r\n            music: 1,\r\n            audio: 1,\r\n            vibrate: 1,\r\n        }\r\n    }\r\n\r\n    private _earlyExportTripPart: string [] = []\r\n    private _earlyExport: string [] = []\r\n    private _exportTime: number = 0\r\n\r\n\r\n    get earlyExportTripPart(): string[] {\r\n        return this._earlyExportTripPart;\r\n    }\r\n\r\n    set earlyExportTripPart(value: string[]) {\r\n        this.saveData(\"_earlyExportTripPart\", value)\r\n        this._earlyExportTripPart = value;\r\n    }\r\n\r\n    get earlyExport(): string[] {\r\n        return this._earlyExport;\r\n    }\r\n\r\n    set earlyExport(value: string[]) {\r\n        this.saveData(\"_earlyExport\", value)\r\n        this._earlyExport = value;\r\n    }\r\n\r\n    get exportTime(): number {\r\n        return this._exportTime;\r\n    }\r\n\r\n    set exportTime(value: number) {\r\n        this.saveData(\"_exportTime\", value)\r\n        this._exportTime = value;\r\n    }\r\n\r\n    get isNeedHint(): boolean {\r\n        return this._isNeedHint;\r\n    }\r\n\r\n    set isNeedHint(value: boolean) {\r\n        this._isNeedHint = value;\r\n        this.saveData(\"_isNeedHint\", value, false);\r\n    }\r\n\r\n    get isAuth(): boolean {\r\n        return this._isAuth;\r\n    }\r\n\r\n    set isAuth(value: boolean) {\r\n        this.saveData(\"_isAuth\", value, false);\r\n        this._isAuth = value;\r\n    }\r\n\r\n    get userId(): number {\r\n        return this._userId;\r\n    }\r\n\r\n    set userId(value: number) {\r\n        this.saveData(\"_userId\", value, false);\r\n        this._userId = value;\r\n    }\r\n\r\n    get setting(): CustomData {\r\n        return this._setting;\r\n    }\r\n\r\n    set setting(value: CustomData) {\r\n        this.saveData(\"_setting\", value)\r\n        this._setting = value;\r\n    }\r\n\r\n    get userInfo(): any {\r\n        return this._userInfo;\r\n    }\r\n\r\n    set userInfo(value: any) {\r\n        this.saveData(\"_userInfo\", value, false)\r\n        this._userInfo = value;\r\n    }\r\n\r\n    get newUser(): boolean {\r\n        return this._newUser;\r\n    }\r\n\r\n    set newUser(value: boolean) {\r\n        this.saveData(\"_newUser\", value, false)\r\n        this._newUser = value;\r\n    }\r\n\r\n    get hit(): any[] {\r\n        return this._hit;\r\n    }\r\n\r\n    set hit(value: any[]) {\r\n        this.saveData(\"_hit\", value, false)\r\n        this._hit = value;\r\n    }\r\n\r\n    get lastTimeLogin(): number {\r\n        return this._lastTimeLogin;\r\n    }\r\n\r\n    set lastTimeLogin(value: number) {\r\n        this.saveData(\"_lastTimeLogin\", value, false)\r\n        this._lastTimeLogin = value;\r\n    }\r\n\r\n    get stamina(): number {\r\n        return this._stamina;\r\n    }\r\n\r\n    set stamina(value: number) {\r\n        if (value > Global.config.gameInfo.maxStamina) {\r\n            this._stamina = Global.config.gameInfo.maxStamina;\r\n        } else {\r\n            this._stamina = value;\r\n        }\r\n        this.saveData(\"_stamina\", this._stamina);\r\n    }\r\n\r\n    get checkpoint(): number {\r\n        return this._checkpoint;\r\n    }\r\n\r\n    set checkpoint(value: number) {\r\n        this.saveData(\"_checkpoint\", value);\r\n        this._checkpoint = value;\r\n    }\r\n\r\n    get gold(): number {\r\n        return this._gold;\r\n    }\r\n\r\n    set gold(value: number) {\r\n        this.saveData(\"_gold\", value)\r\n        this._gold = value;\r\n    }\r\n\r\n    get diamond(): number {\r\n        return this._diamond;\r\n    }\r\n\r\n    set diamond(value: number) {\r\n        this.saveData(\"_diamond\", value)\r\n        this._diamond = value;\r\n    }\r\n\r\n    get user_code(): string {\r\n        return this._user_code;\r\n    }\r\n\r\n    set user_code(value: string) {\r\n        this.saveData(\"_user_codes\", value, false)\r\n        this._user_code = value;\r\n    }\r\n\r\n    get openId(): string {\r\n        return this._openId;\r\n    }\r\n\r\n    set openId(value: string) {\r\n        this.saveData(\"_openId\", value, false)\r\n        this._openId = value;\r\n    }\r\n\r\n    //都用json 存储吧 ，不然太麻烦了\r\n    private saveData(key: string, value: any, isSend: boolean = true) {\r\n\r\n        if (value instanceof Map) {\r\n            localStorage.setItem(key, this._mapToJson(value))\r\n        } else {\r\n            localStorage.setItem(key, JSON.stringify(value))\r\n        }\r\n    }\r\n\r\n    private getData(key: string): boolean {\r\n        let result = true\r\n        let dataText = localStorage.getItem(key)\r\n        if (dataText == null || dataText == \"\" || dataText == undefined) {\r\n            result = false\r\n            this.saveData(key, this[key], false) //没有的话，先给他存进去\r\n            return\r\n        }\r\n        if (this[key] instanceof Map) {\r\n            this[key] = this._jsonToMap(dataText)\r\n        } else {\r\n            this[key] = JSON.parse(dataText)\r\n        }\r\n        return result\r\n    }\r\n\r\n    private _strMapToObj(strMap) {\r\n        let obj = Object.create(null);\r\n        strMap.forEach((v, k) => {\r\n            obj[k] = v;\r\n        })\r\n        return obj;\r\n    }\r\n\r\n    /**\r\n     *map转换为json\r\n     */\r\n    private _mapToJson(map) {\r\n        return JSON.stringify(this._strMapToObj(map));\r\n    }\r\n\r\n    private _objToStrMap(obj) {\r\n        let strMap = new Map();\r\n        for (let k of Object.keys(obj)) {\r\n            strMap.set(k, obj[k]);\r\n        }\r\n        return strMap;\r\n    }\r\n\r\n    /**\r\n     *json转换为map\r\n     */\r\n    private _jsonToMap(jsonStr) {\r\n        return this._objToStrMap(JSON.parse(jsonStr));\r\n    }\r\n\r\n    /**\r\n     * @private 同步信息到服务端\r\n     */\r\n    public updateData() {\r\n        let data = {\r\n            checkpoint: this._checkpoint,\r\n            diamond: this._diamond,\r\n            gold: this._gold,\r\n            setting: JSON.stringify(this._setting),\r\n            stamina: this.stamina,\r\n            userId: this.userId\r\n        }\r\n    }\r\n}\r\n\r\nexport default new CachesMgr()\r\n\r\ninterface Setting {\r\n    music: number,  // 音乐音量大小 0 -1\r\n    audio: number,  // 音效音量大小\r\n    vibrate: number // 是否震动\r\n}\r\n\r\ninterface CustomData {\r\n    signTime: number  //上次签到时间\r\n    hammerNum: number //剩余锤子个数\r\n    spriteNum: number //剩余恶魔次数\r\n    lastSignNum: number //上次签到时间\r\n    signNum: number   //当前签到次数\r\n    hintNum: number  //免费提示数据\r\n    setting: Setting\r\n}\r\n"]}